/*
 * temp.c
 *
 *  Created on: Jun 5, 2018
 *      Author: Michael McCaffrey
 */

#include "temp.h"

const float si_diode_temperatures[] = { 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2.0, 2.1, 2.2, 2.3, 2.4,
                       2.5, 2.6, 2.7, 2.8, 2.9, 3.0, 3.1, 3.2, 3.3, 3.4, 3.5,
                       3.6, 3.7, 3.8, 3.9, 4.0, 4.2, 4.4, 4.6, 4.8, 5.0, 5.2,
                       5.4, 5.6, 5.8, 6.0, 6.5, 7.0, 7.5, 8.0, 8.5, 9.0, 9.5,
                       10.0, 10.5, 11.0, 11.5, 12.0, 12.5, 13.0, 13.5, 14.0,
                       14.5, 15.0, 15.5, 16.0, 16.5, 17.0, 17.5, 18.0, 18.5,
                       19.0, 19.5, 20.0, 21.0, 22.0, 23.0, 24.0, 25.0, 26.0,
                       27.0, 28.0, 29.0, 30.0, 31.0, 32.0, 33.0, 34.0, 35.0,
                       36.0, 37.0, 38.0, 39.0, 40.0, 42.0, 44.0, 46.0, 48.0,
                       50.0, 52.0, 54.0, 56.0, 58.0, 60.0, 65.0, 70.0, 75.0,
                       77.35, 80.0, 85.0, 90.0, 100.0, 110.0, 120.0, 130.0,
                       140.0, 150.0, 160.0, 170.0, 180.0, 190.0, 200.0, 210.0,
                       220.0, 230.0, 240.0, 250.0, 260.0, 270.0, 273.0, 280.0,
                       290.0, 300.0, 310.0, 320.0, 330.0, 340.0, 350.0 };

const float si_diode_voltages[] = { 1.644290, 1.642990, 1.641570, 1.640030, 1.638370, 1.636600,
                                  1.634720, 1.632740, 1.630670, 1.628520, 1.626290, 1.624000,
                   1.621660, 1.619280, 1.616870, 1.614450, 1.612000, 1.609510,
                   1.606970, 1.604380, 1.601730, 1.599020, 1.596260, 1.59344,
                   1.59057, 1.58764, 1.58465, 1.57848, 1.57202, 1.56533,
                   1.55845, 1.55145, 1.54436, 1.53721, 1.53000, 1.52273,
                   1.51541, 1.49698, 1.47868, 1.46086, 1.44374, 1.42747,
                   1.41207, 1.39751, 1.38373, 1.37065, 1.35820, 1.34632,
                   1.33499, 1.32416, 1.31381, 1.30390, 1.29439, 1.28526,
                   1.27645, 1.26794, 1.25967, 1.25161, 1.24372, 1.23596,
                   1.22830, 1.22070, 1.21311, 1.20548, 1.19774, 1.18154,
                   1.16279, 1.14081, 1.12592, 1.11944, 1.11565, 1.11281,
                   1.110421, 1.108261, 1.106244, 1.104324, 1.102476, 1.100681,
                   1.098930, 1.097216, 1.095534, 1.093878, 1.092244, 1.090627,
                   1.089024, 1.085842, 1.082669, 1.079492, 1.076303, 1.073099,
                   1.069881, 1.066650, 1.063403, 1.060141, 1.056862, 1.048584,
                   1.040183, 1.031651, 1.027594, 1.022984, 1.014181, 1.005244,
                   0.986974, 0.968209, 0.949000, 0.929390, 0.909416, 0.889114,
                   0.868518, 0.847659, 0.826560, 0.805242, 0.783720, 0.762007,
                   0.740115, 0.718054, 0.695834, 0.673462, 0.650949, 0.628302,
                   0.621141, 0.605528, 0.582637, 0.559639, 0.536542, 0.513361,
                   0.490106, 0.466760, 0.443371 };

uint16_t SI_Lookup(uint16_t adc_value){

    float voltage = 3.3 * ((float)adc_value / 1024);
    float temp = 350.0;
    uint16_t i;
    for(i = sizeof(si_diode_voltages)/sizeof(temp); i > 0; i--){
        temp = si_diode_temperatures[i];
        if(si_diode_voltages[i] > voltage){
            break;
        }
    }
    return (uint16_t)(temp * 10);

}

